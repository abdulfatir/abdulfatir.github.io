function randomFloat(t){return Math.random()*t}function randomInt(t){return Math.floor(Math.random()*t)}function randomInteger(t,e){return Math.floor(Math.random()*(e-t)+t)}function deep_copy(t,e){for(var r=t.length;r--;)e[r]=[t[r][0],t[r][1]]}function getCost(t){for(var e=0,r=0;r<CITIES-1;r++)e+=getDistance(t[r],t[r+1]);return e+=getDistance(t[0],t[CITIES-1])}function getDistance(t,e){return del_x=t[0]-e[0],del_y=t[1]-e[1],Math.sqrt(del_x*del_x+del_y*del_y)}function mutate2Opt(t,e,r){var a=[];for(deep_copy(t,a);e!=r;){var n=a[r];if(a[r]=a[e],a[e]=n,(e=(e+1)%CITIES)==r)break;r=(r-1+CITIES)%CITIES}return a}function acceptanceProbability(t,e){return e<t?1:Math.exp((t-e)/temperature)}function init(){for(var t=0;t<CITIES;t++)current[t]=[randomInteger(10,tsp_canvas.width-10),randomInteger(10,tsp_canvas.height-10)];deep_copy(current,best),best_cost=getCost(best),setInterval(solve,10)}function solve(){if(temperature>ABSOLUTE_ZERO){var t=getCost(current),e=randomInt(CITIES),r=(e+1+randomInt(CITIES-2))%CITIES;if(e>r){var a=e;e=r,r=a}var n=mutate2Opt(current,e,r),s=getCost(n);Math.random()<acceptanceProbability(t,s)&&(deep_copy(n,current),t=getCost(current)),t<best_cost&&(deep_copy(current,best),best_cost=t,paint()),temperature*=COOLING_RATE}}function paint(){tsp_ctx.clearRect(0,0,tsp_canvas.width,tsp_canvas.height);for(var t=0;t<CITIES;t++)tsp_ctx.beginPath(),tsp_ctx.arc(best[t][0],best[t][1],4,0,2*Math.PI),tsp_ctx.fillStyle="#0000ff",tsp_ctx.strokeStyle="#000",tsp_ctx.closePath(),tsp_ctx.fill(),tsp_ctx.lineWidth=1,tsp_ctx.stroke();tsp_ctx.strokeStyle="#ff0000",tsp_ctx.lineWidth=2,tsp_ctx.moveTo(best[0][0],best[0][1]);for(t=0;t<CITIES-1;t++)tsp_ctx.lineTo(best[t+1][0],best[t+1][1]);tsp_ctx.lineTo(best[0][0],best[0][1]),tsp_ctx.stroke(),tsp_ctx.closePath()}var temprature=.1,ABSOLUTE_ZERO=1e-4,COOLING_RATE=.999999,CITIES=50,current=[],best=[],best_cost=0;$(document).ready(function(){$("#solve").click(function(){temperature=parseFloat($("#temperature").val()),ABSOLUTE_ZERO=parseFloat($("#abszero").val()),COOLING_RATE=parseFloat($("#coolrate").val()),CITIES=parseInt($("#cities").val()),init()})});var tsp_canvas=document.getElementById("tsp-canvas"),tsp_ctx=tsp_canvas.getContext("2d");